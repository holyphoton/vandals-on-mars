<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mouse Lock Test - Debugging the X-Axis Locked Camera</title>
    <style>
        body { margin: 0; overflow: hidden; font-family: Arial, sans-serif; background-color: #222; color: white; }
        #canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }
        #info {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 10px;
            border-radius: 5px;
            z-index: 2;
            pointer-events: none;
        }
        #debug {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 10px;
            border-radius: 5px;
            z-index: 2;
            width: 300px;
            pointer-events: none;
            white-space: pre-wrap;
        }
        #start-button {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 12px 24px;
            background: #c1440e;
            border: none;
            color: white;
            font-size: 1.2em;
            cursor: pointer;
            z-index: 3;
            border-radius: 5px;
        }
        #start-button:hover {
            background: #e05511;
        }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    
    <div id="info">
        Click START to enable pointer lock<br>
        Move mouse to rotate camera<br>
        Press ESC to exit pointer lock
    </div>
    
    <div id="debug">Camera rotation: 0°</div>
    
    <button id="start-button">START</button>
    
    <script src="https://cdn.jsdelivr.net/npm/three@0.148.0/build/three.min.js"></script>
    
    <script>
        // Main variables
        let camera, scene, renderer;
        let isLocked = false;
        let yRotation = 0;
        let debugElement;
        let canvas;
        let mouseSensitivity = 0.002;
        
        // Initialize everything when the document is loaded
        window.addEventListener('load', function() {
            // Get DOM elements
            canvas = document.getElementById('canvas');
            debugElement = document.getElementById('debug');
            
            // Set up the start button
            document.getElementById('start-button').addEventListener('click', function() {
                this.style.display = 'none';
                initPointerLock();
            });
            
            // Set up THREE.js scene
            initScene();
        });
        
        // Set up a basic THREE.js scene
        function initScene() {
            // Create the scene
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x222222);
            
            // Create the camera
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.z = 5;
            
            // Create the renderer
            renderer = new THREE.WebGLRenderer({
                canvas: canvas,
                antialias: true
            });
            renderer.setSize(window.innerWidth, window.innerHeight);
            
            // Add a simple reference cube
            const geometry = new THREE.BoxGeometry(1, 1, 1);
            const material = new THREE.MeshBasicMaterial({ color: 0xc1440e, wireframe: true });
            const cube = new THREE.Mesh(geometry, material);
            scene.add(cube);
            
            // Add coordinate axes for reference
            const axesHelper = new THREE.AxesHelper(5);
            scene.add(axesHelper);
            
            // Handle window resize
            window.addEventListener('resize', function() {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            });
            
            // Start animation loop
            animate();
        }
        
        // Set up pointer lock for mouse movement
        function initPointerLock() {
            // Check if pointer lock is supported
            if ('pointerLockElement' in document || 
                'mozPointerLockElement' in document || 
                'webkitPointerLockElement' in document) {
                
                // Event listeners for pointer lock changes
                document.addEventListener('pointerlockchange', pointerLockChange, false);
                document.addEventListener('mozpointerlockchange', pointerLockChange, false);
                document.addEventListener('webkitpointerlockchange', pointerLockChange, false);
                
                // Event listeners for pointer lock errors
                document.addEventListener('pointerlockerror', pointerLockError, false);
                document.addEventListener('mozpointerlockerror', pointerLockError, false);
                document.addEventListener('webkitpointerlockerror', pointerLockError, false);
                
                // Try to lock the pointer
                requestPointerLock();
                
            } else {
                debugElement.textContent = 'ERROR: Pointer lock not supported in your browser';
            }
        }
        
        // Request pointer lock on the document
        function requestPointerLock() {
            if (canvas.requestPointerLock) {
                canvas.requestPointerLock();
            } else if (canvas.mozRequestPointerLock) {
                canvas.mozRequestPointerLock();
            } else if (canvas.webkitRequestPointerLock) {
                canvas.webkitRequestPointerLock();
            }
        }
        
        // Handle pointer lock change events
        function pointerLockChange() {
            if (document.pointerLockElement === canvas || 
                document.mozPointerLockElement === canvas || 
                document.webkitPointerLockElement === canvas) {
                
                // Pointer is locked - enable mouse movement
                isLocked = true;
                document.addEventListener('mousemove', onMouseMove, false);
                debugElement.textContent = 'Pointer locked. Move your mouse to rotate.';
                
            } else {
                // Pointer is unlocked - disable mouse movement
                isLocked = false;
                document.removeEventListener('mousemove', onMouseMove, false);
                debugElement.textContent = 'Pointer unlocked. Click START to re-enable.';
                document.getElementById('start-button').style.display = 'block';
            }
        }
        
        // Handle pointer lock error
        function pointerLockError() {
            debugElement.textContent = 'ERROR: Pointer lock failed. Try clicking again.';
        }
        
        // Handle mouse movement for camera rotation (only X-axis, as requested)
        function onMouseMove(event) {
            if (!isLocked) return;
            
            // Get mouse movement deltas
            const movementX = event.movementX || 
                             event.mozMovementX || 
                             event.webkitMovementX || 0;
            
            // Apply rotation only to Y axis (horizontal rotation)
            yRotation -= movementX * mouseSensitivity;
            
            // Apply the rotation to the camera
            camera.rotation.y = yRotation;
            
            // Log rotation for debugging
            const rotationDegrees = (yRotation * 180 / Math.PI).toFixed(1);
            debugElement.textContent = `Camera rotation: ${rotationDegrees}°\n` +
                                       `Movement X: ${movementX}\n` +
                                       `Is Locked: ${isLocked}`;
            
            console.log('Camera rotation (X-axis locked):', rotationDegrees + '°');
        }
        
        // Animation loop
        function animate() {
            requestAnimationFrame(animate);
            renderer.render(scene, camera);
        }
    </script>
</body>
</html> 